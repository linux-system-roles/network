# SPDX-License-Identifier: BSD-3-Clause
---
- name: Test configuring bridges
  hosts: all
  vars:
    interface: LSR-TST-br31
  tasks:
    - name: Include the task 'run_test.yml'
      include_tasks: tasks/run_test.yml
      vars:
        lsr_description: Test configuring bridges
        lsr_setup:
          - tasks/show_interfaces.yml
          - what: tasks/assert_device_absent.yml
            condition: "{{ not __bootc_validation | d(false) }}"
        lsr_test:
          - network_connections:
              - name: "{{ interface }}"
                interface_name: "{{ interface }}"
                state: up
                type: bridge
                ip:
                  dhcp4: false
                  auto6: true
        lsr_assert:
          - tasks/assert_device_present.yml
          - what: tasks/assert_profile_present.yml
            profile: "{{ interface }}"
        lsr_cleanup:
          - what: tasks/down_profile+delete_interface.yml
            condition: "{{ __network_is_booted }}"
            profile: "{{ interface }}"
            lsr_persistent_state: absent
          - what: tasks/remove_profile.yml
            profile: "{{ interface }}"
          - what: tasks/assert_profile_absent.yml
            profile: "{{ interface }}"
          - what: tasks/assert_device_absent.yml
            profile: "{{ interface }}"
          - tasks/check_network_dns.yml

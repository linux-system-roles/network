# SPDX-License-Identifier: BSD-3-Clause
# This file was generated by ensure_provider_tests.py
---
# set network provider and gather facts
- hosts: all
  name: Run playbook 'playbooks/tests_ethtool_features.yml' with nm as provider
  tasks:
    - include_tasks: tasks/el_repo_setup.yml  # noqa name
    - name: Set network provider to 'nm'
      set_fact:
        network_provider: nm
      tags:
        - always

    - block:  # noqa name
        - name: Install NetworkManager
          package:
            name: NetworkManager
            state: present
        - name: Get NetworkManager version  # noqa command-instead-of-module
          command: rpm -q --qf "%{version}" NetworkManager
          register: networkmanager_version
          when: true
      when:
        - ansible_distribution_major_version != '6'
      tags:
        - always


# The test requires or should run with NetworkManager, therefore it cannot run
# on RHEL/CentOS 6
# NetworkManager 1.20.0 introduced ethtool settings support
- import_playbook: playbooks/tests_ethtool_features.yml
  when:
    - ansible_distribution_major_version != '6'

    - networkmanager_version.stdout is version('1.20.0', '>=')

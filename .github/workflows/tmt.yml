name: Schedule test on Testing Farm
on:
  issue_comment:
    types:
      - created

# The concurrency key is used to prevent multiple workflows from running at the same time
concurrency:
  group: my-concurrency-group
  cancel-in-progress: true

jobs:
  tests:
    name: Testing Farm tests
    # strategy:
    #   fail-fast: false
    #   matrix:
    #     os_test: [ "Fedora-39", "Fedora-40", "CentOS-7", "CentOS-8", "CentOS-9" ]
    runs-on: ubuntu-latest
    # Let's schedule tests only on user request. NOT automatically.
    # Only repository owner or member can schedule tests
    # if: |
    #   github.event.issue.pull_request
    #   && contains(github.event.comment.body, '[citest]')
    #   && contains(fromJson('["OWNER", "MEMBER", "COLLABORATOR"]'), github.event.comment.author_association)
    steps:
      - name: Schedule test on Testing Farm
        uses: sclorg/testing-farm-as-github-action@v2
        with:
          git_url: https://github.com/spetrosi/tft-tests
          git_ref: add-tmt-tests
          tmt_path: plans/${{ github.event.repository.name }}
          compose: Fedora-40
          api_key: ${{ secrets.TF_API_KEY_PUB }}
          pull_request_status_name: Fedora-40
          variables: "ANSIBLE_VER=2.16;REPO_NAME=${{ github.event.repository.name }};PR_NUM=${{ github.event.number }}"
